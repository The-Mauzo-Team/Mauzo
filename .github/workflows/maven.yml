name: Java and Maven CI

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Set up JDK 1.8
      uses: actions/setup-java@v1
      with:
        java-version: 1.8
    - name: Clean with Maven
      run: mvn clean --file pom.xml
    - name: Compile with Maven
      run: mvn compile --file pom.xml
    - name: Package with Maven
      run: mvn package --file pom.xml
  deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
      name: Checkout the Source Code
    - uses: mr-smithers-excellent/docker-build-push@v2
      name: Deploy to Docker Container Registry
      with:
        image: neirth/gestiontiendas/main
        tag: latest
        registry: docker.pkg.github.com
        dockerfile: Dockerfile
        username: Neirth
        password: ${{ secrets.GITHUB_TOKEN }}